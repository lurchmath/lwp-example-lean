var LeanOutputArray,LeanOutputObject,Module,bodyGroupToCode,bodyIsASection,checkTimer,clearAllValidity,clearValidity,documentToCode,hasValidity,isSubterm,leanCommands,markValid,myTimer,now,pathExists,runLeanOn,sectionGroupToCode,setValidity,startTimer,termGroupToCode,validate,validateButton,validationRunning,hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},slice=[].slice;setAppName("LeanApp"),addHelpMenuSourceCodeLink("lwp-example-lean/blob/master/lwp-example-lean.litcoffee"),window.helpAboutText='<p>See the fully documented <a target="top" href="https://github.com/lurchmath/lwp-example-lean/blob/master/lwp-example-lean.litcoffee" >source code for this demo app</a>.</p>',window.pluginsToLoad.push("equationeditor"),myTimer=null,now=function(){return(new Date).getTime()},startTimer=function(){return myTimer=now()},checkTimer=function(){return"(took "+(now()-myTimer)+" ms)"},(Module=window.Module={}).TOTAL_MEMORY=67108864,Module.noExitRuntime=!0,LeanOutputObject=null,LeanOutputArray=null,Module.print=function(e){var t;if(t=null,t=/FLYCHECK_BEGIN (.*)/.exec(e))return LeanOutputObject={type:t[1],text:[]};if(LeanOutputObject)return(t=/([^:]+):(\d+):(\d+): (.*)/.exec(e))?(LeanOutputObject.file=t[1],LeanOutputObject.line=t[2],LeanOutputObject.char=t[3],LeanOutputObject.info=t[4]):/FLYCHECK_END/.test(e)?(LeanOutputArray.push(LeanOutputObject),LeanOutputObject=null):LeanOutputObject.text.push(e);throw new Error("Unexpected output from Lean: "+e)},Module.preRun=[function(){}],runLeanOn=window.runLeanOn=function(e){return Module.lean_init(!1),Module.lean_import_module("standard"),FS.writeFile("test.lean",e,{encoding:"utf8"}),LeanOutputArray=[],Module.lean_process_file("test.lean"),LeanOutputArray},validationRunning=!1,setValidity=function(e,t,n){return e.set("closeDecoration",t),e.set("closeHoverText",n)},markValid=function(e,t,n){var o,r;return o=t?"green":"red",r=t?"&#10003;":"&#10006;",setValidity(e,"<font color='"+o+"'>"+r+"</font>",n)},clearValidity=function(e){return e.clear("closeDecoration"),e.clear("closeHoverText")},hasValidity=function(e){return void 0!==e.get("closeDecoration")},clearAllValidity=function(){var e,t,n,o,r;if(!validationRunning){for(validationRunning=!0,t=0,o=(r=(e=tinymce.activeEditor.Groups).ids()).length;t<o;t++)n=r[t],clearValidity(e[n]);return validationRunning=!1}},validate=window.validate=function(){var e,t,n,o,r,i,a,c,u,s,l,d,m,f,p,h,y,g,b,v,T,w,C,O,x,E,L,M,R,k,A,N,G;if(i=tinymce.activeEditor.Groups,!validationRunning){for(validationRunning=!0,a=0,h=(E=i.ids()).length;a<h;a++)c=E[a],"term"===i[c].typeName()&&"term"===(null!=(L=i[c].parent)?L.typeName():void 0)&&markValid(i[c],!1,"A term group cannot be inside another term group.");for(w={},u=l=0,y=(M=(p=documentToCode()).lines).length;l<y;u=++l)T=M[u],(C=/[ ]--[ ](\d+)$/.exec(T))&&(w[u+1]=parseInt(C[1]));for(f=-1,t=p.lines.join("\n").replace(String.fromCharCode(160),String.fromCharCode(32)),d=0,g=(R=runLeanOn(t)).length;d<g;d++)O=R[d],c=w[O.line],(s=/error:/.test(O.info))&&(f=c),r="Lean reported:\n\n"+O.info,O.text.length&&(r+="\n"+O.text.join("\n")),e=(e=parseInt(O.char))>0?(n=p.lines[O.line-1],"\n\ncharacter #"+(e+1)+" in this code: \n"+/^(.*) -- \d+$/.exec(n)[1]):"",markValid(i[c],!s,r+e);for(m=0,b=(k=i.ids()).length;m<b&&(c=k[m])!==f;m++)hasValidity(i[c])||markValid(i[c],!0,"No errors reported.");for(x=0,v=(A=i.ids()).length;x<v;x++)if(c=A[x],"type"===(G=i[c].typeName())){if(isSubterm(i[c]))continue;0===function(){var e,t,n,r;for(r=[],t=0,e=(n=i[c].connectionsOut()).length;t<e;t++)o=n[t],"term"===i[o[1]].typeName()&&r.push(o[1]);return r}().length&&setValidity(i[c],'<font color="#aaaa00"><b>&#10039;</b></font>',"This "+G+" does not modify any terms, and was thus ignored in validation.  Did you mean to connect it to a term?")}N=p.errors;for(c in N)hasProp.call(N,c)&&(O=N[c],markValid(i[c],!1,O));return validationRunning=!1}},validateButton=null,window.groupToolbarButtons.validate={text:"Run Lean",tooltip:"Run Lean on this document",onclick:function(){return validateButton.text("Running..."),validateButton.disabled(!0),setTimeout(function(){return validate(),validateButton.disabled(!1),validateButton.text("Run Lean")},0)},onPostRender:function(){return validateButton=this}},leanCommands={check:"check (TERM)",eval:"eval (TERM)",print:'print "TERM"',import:"import TERM",open:"open TERM",constant:"constant TERM",variable:"variable TERM",definition:"definition TERM",theorem:"theorem TERM",example:"example TERM"},window.groupTypes=[{name:"term",text:"Lean Term",tooltip:"Make the selection a Lean term",color:"#666666",imageHTML:'<font color="#666666"><b>[ ]</b></font>',openImageHTML:'<font color="#666666"><b>[</b></font>',closeImageHTML:'<font color="#666666"><b>]</b></font>',contentsChanged:clearAllValidity,tagContents:function(e){var t;return(t=e.get("leanCommand"))?"Command: "+t:null},contextMenuItems:function(e){return[{text:"Edit command...",onclick:function(){var t,n;if(null!==(t=prompt("Enter the Lean command to use on this code (or leave blank for none).\n \nValid options include:\n"+Object.keys(leanCommands).join(" "),null!=(n=e.get("leanCommand"))?n:"")))return""===t?e.clear("leanCommand"):t in leanCommands?e.set("leanCommand",t):alert("That was not one of the choices.  No change has been made to your document.")}}]},connectionRequest:function(e,t){var n,o;if("term"===t.typeName()||"body"===t.typeName())return o=t.id(),indexOf.call(function(){var t,o,r,i;for(i=[],t=0,o=(r=e.connectionsOut()).length;t<o;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?tinymce.activeEditor.undoManager.transact(function(){return e.disconnect(t)}):pathExists(t.id(),e.id())?alert("That would create a cycle of arrows, which is not permitted."):tinymce.activeEditor.undoManager.transact(function(){return e.connect(t)})},connections:function(e){var t,n,o;return n=e.connectionsOut(),t=e.connectionsIn(),slice.call(n).concat(slice.call(t),slice.call(function(){var e,t,r;for(r=[],e=0,t=n.length;e<t;e++)o=n[e],r.push(o[1]);return r}()),slice.call(function(){var e,n,r;for(r=[],e=0,n=t.length;e<n;e++)o=t[e],r.push(o[0]);return r}()))}}],termGroupToCode=window.termGroupToCode=function(e){var t,n,o,r,i,a,c,u,s,l,d,m,f,p,h,y,g,b,v,T;if(l=tinymce.activeEditor.Groups,e.children.length>0)throw Error("Invalid structure: Term groups may not contain other groups");for(v=e.contentAsText().trim(),o=function(){var t,n,o,r;for(r=[],t=0,n=(o=e.connectionsOut()).length;t<n;t++)u=o[t],r.push(u[1]);return r}(),n=function(){var e,n,r;for(r=[],e=0,n=o.length;e<n;e++){t=o[e];try{"term"===l[t].typeName()?r.push(termGroupToCode(l[t])):r.push(bodyGroupToCode(l[t]))}catch(e){throw s=e,markValid(l[t],!1,s.message),Error("A term to which this term points (directly or indirectly) contains an error, and thus this term's meaning cannot be determined.")}}return r}(),o.length>0&&(v="( -- "+e.id()+"\n "+v+" -- "+e.id()+"\n "+n.join("\n")+"\n )"),p=[],i=[],r=[],d=0,m=(h=e.connectionsIn()).length;d<m;d++)u=h[d],"type"===(b=l[u[0]]).typeName()?(T=b.contentAsText().trim(),indexOf.call(i,T)<0&&i.push(T)):"body"===b.typeName()&&(y=b.id(),indexOf.call(r,y)<0)?r.push(b.id()):"term"===b.typeName()&&p.push(b);if(i.length>1)throw Error("Invalid structure: Two different types are assigned to this term ("+i.join(", ")+")");if(r.length>1)throw Error("Invalid structure: Two bodies are assigned to this term.");if(p.length>0){if(i.length>0)throw Error("Invalid structure: A subterm of another term cannot have a type assigned.");if(r.length>0)throw Error("Invalid structure: A subterm of another term cannot have a body assigned.")}if(i.length>0&&(T=i[0],v=(f=/^\s*check\s+(.*)$/.exec(v))?"check ("+f[1]+" : "+T+")":(f=/^\s*check\s+\((.*)\)\s*$/.exec(v))?"check ("+f[1]+" : "+T+")":(f=/^(.*):=(.*)$/.exec(v))?f[1]+" : "+T+" := "+f[2]:v+" : "+T),(a=e.get("leanCommand"))&&(v=leanCommands[a].replace("TERM",v)),g=v+" -- "+e.id(),r.length>0){if(c=["theorem","definition","example"],indexOf.call(c,a)<0)throw Error("Terms may only be assigned bodies if they embed one of these commands: "+c.join(", ")+".");g+="\n:= "+bodyGroupToCode(l[r[0]])}return g},documentToCode=window.documentToCode=function(){var e,t,n,o,r,i,a;for(a={lines:[],errors:{}},n=0,o=(i=tinymce.activeEditor.Groups.topLevel).length;n<o;n++)if("body"===(t=i[n]).typeName()&&bodyIsASection(t))r=sectionGroupToCode(t),a.lines=a.lines.concat(r.split("\n"));else if("term"===t.typeName()&&!isSubterm(t))try{r=termGroupToCode(t),a.lines=a.lines.concat(r.split("\n"))}catch(n){e=n,a.errors[t.id()]=e.message}return a},isSubterm=function(e){var t,n,o,r;for(n=0,o=(r=e.connectionsIn()).length;n<o;n++)if(t=r[n],"term"===tinymce.activeEditor.Groups[t[0]].typeName())return!0;return!1},bodyIsASection=function(e){var t,n,o,r;for(n=0,o=(r=e.connectionsOut()).length;n<o;n++)if(t=r[n],"term"===tinymce.activeEditor.Groups[t[1]].typeName())return!1;return!0},pathExists=function(e,t){var n,o,r,i,a;for(o=tinymce.activeEditor.Groups,a=[],i=[e];i.length>0;){if((r=i.shift())===t)return!0;indexOf.call(a,r)>=0||(a.push(r),i=i.concat(function(){var e,t,i,a;for(a=[],e=0,t=(i=o[r].connectionsOut()).length;e<t;e++)n=i[e],a.push(n[1]);return a}()))}return!1},window.groupTypes.push({name:"type",text:"Lean Type",tooltip:"Make the selection a Lean type",color:"#66bb66",imageHTML:'<font color="#66bb66"><b>[ ]</b></font>',openImageHTML:'<font color="#66bb66"><b>[</b></font>',closeImageHTML:'<font color="#66bb66"><b>]</b></font>',contentsChanged:clearAllValidity,connectionRequest:function(e,t){var n,o;if("term"===t.typeName())return o=t.id(),indexOf.call(function(){var t,o,r,i;for(i=[],t=0,o=(r=e.connectionsOut()).length;t<o;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?tinymce.activeEditor.undoManager.transact(function(){return e.disconnect(t)}):tinymce.activeEditor.undoManager.transact(function(){return e.connect(t)})}}),window.useGroupConnectionsUI=!0,window.groupTypes.push({name:"body",text:"Body of a Lean definition or section",tooltip:"Make the selection a body",color:"#6666bb",imageHTML:'<font color="#6666bb"><b>[ ]</b></font>',openImageHTML:'<font color="#6666bb"><b>[</b></font>',closeImageHTML:'<font color="#6666bb"><b>]</b></font>',contentsChanged:clearAllValidity,contextMenuItems:function(e){var t;return t=function(){var t;if(null!==(t=prompt("Enter the identifier to use as the name of the namespace.",e.get("namespace"))))return/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(t)?e.set("namespace",t):alert("That was a valid Lean identifier.  No change has been made to your document.")},bodyIsASection(e)?e.get("namespace")?[{text:"Make this a section",onclick:function(){return e.clear("namespace")}},{text:"Rename this namespace...",onclick:t}]:[{text:"Make this a namespace...",onclick:t}]:[]},tagContents:function(e){var t;return bodyIsASection(e)?(t=e.get("namespace"))?"Namespace: "+t:"Section":""},connectionRequest:function(e,t){var n,o;if("term"===t.typeName())return o=t.id(),indexOf.call(function(){var t,o,r,i;for(i=[],t=0,o=(r=e.connectionsOut()).length;t<o;t++)n=r[t],i.push(n[1]);return i}(),o)>=0?tinymce.activeEditor.undoManager.transact(function(){return e.disconnect(t)}):pathExists(t.id(),e.id())?alert("That would create a cycle of arrows, which is not permitted."):tinymce.activeEditor.undoManager.transact(function(){return e.connect(t)})}}),bodyGroupToCode=window.bodyGroupToCode=function(e){var t,n,o,r,i,a,c,u,s,l,d,m,f,p;if(0===(n=function(){var n,o,r,i;for(i=[],n=0,o=(r=e.children).length;n<o;n++)"term"!==(t=r[n]).typeName()&&"body"!==t.typeName()||i.push(t);return i}()).length)return e.contentAsText()+" -- "+e.id();for(i=r=0,u=(d=n.slice(0,-1)).length;r<u;i=++r)if("body"===(t=d[i]).typeName())throw Error("A body group can only contain other body groups as its final child.  This one has another body group as child #"+(i+1)+".");for(o=tinymce.activeEditor.Groups,(p=function(e){var n,r,i,a,c,u,s,l;for(r=0,a=(u=e.connectionsIn()).length;r<a;r++)if(n=u[r],"body"===o[n[0]].typeName())throw Error("One of the groups inside this body has a body group connected to it.  That type of nesting is not permitted.");for(l=[],i=0,c=(s=e.children).length;i<c;i++)t=s[i],l.push(p(t));return l})(e),f=[],a=0,s=n.length;a<s;a++)if("term"===(t=n[a]).typeName()){if(isSubterm(t))continue;f.push(termGroupToCode(t))}else f.push(bodyGroupToCode(t));for(i=c=0,m=f.length-1;0<=m?c<m:c>m;i=0<=m?++c:--c)l=/^(.*) -- (\d+)$/.exec(f[i]),f[i]="assume "+l[1]+", -- "+l[2];return f.join("\n")},sectionGroupToCode=window.sectionGroupToCode=function(e){var t,n,o,r,i,a,c,u,s;for(s=(i=e.get("namespace"))?"namespace":"section",u=null!=i?i:e.id(),o=("namespace"===s?"":s)+u,c=[],n=0,r=(a=e.children).length;n<r;n++)if(t=a[n],!isSubterm(t))try{if("term"===t.typeName())c.push(termGroupToCode(t));else if("body"===t.typeName()){if(!bodyIsASection(t))continue;c.push(sectionGroupToCode(t))}}catch(e){markValid(t,!1,e.message)}return s+" "+o+" -- "+e.id()+"\n "+c.join("\n")+"\n end "+o+" -- "+e.id()},window.afterEditorReady=function(e){return e.on("KeyUp",function(t){var n,o,r,i,a,c,u,s,l,d,m,f,p,h;if(c=[33,34,35,36,37,38,39,40],a=[16,17,18,91],l=t.keyCode,!(indexOf.call(c,l)>=0||(d=t.keyCode,indexOf.call(a,d)>=0))&&(s=e.selection.getRng()).startContainer===s.endContainer&&3===(null!=(m=s.startContainer)?m.nodeType:void 0)){if(r=s.startContainer.textContent," "!==(i=r[s.startOffset-1])&&"\\"!==i&&i!==String.fromCharCode(160))return;if(o=r.substr(0,s.startOffset-1),n=r.substring(s.startOffset-1),-1===(p=o.lastIndexOf("\\")))return;if(h=o.substr(p+1),o=o.substr(0,p),!(f=corrections[h]))return;return u=s.startOffset-h.length-1+f.length,"\\"!==i&&(n=n.substr(1),u--),s.startContainer.textContent=o+f+n,s.setStart(s.startContainer,u),s.setEnd(s.startContainer,u),e.selection.setRng(s)}})};
//# sourceMappingURL=lwp-example-lean.js.map
